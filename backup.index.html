<!DOCTYPE html>
<html ng-app='getData'>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<title>Express Test</title>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
		<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src = '/scripts/script.js'></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	</head>
	<body>
		<div ng-controller="gettingDataController">
		<div class= 'row col-md-12'>
			<div class = 'col-md-6'>
				<label for = 'name'>Your name
				<select class = 'form-control' name = 'name' id='nameSelector' ng-change='setPerson(person)'ng-model="person">
					<option ng-repeat="personIndex in people track by $index" value='{{personIndex.index}}'>{{personIndex.name}}</option>

				</select>
			</div>
			<div class = 'col-md-6'>
				<label for = 'date'>Date
				<input type = 'text' name = 'date' id='datePicker' ng-model = "person.registered"/>
			</div>
		</div>
		<div class = 'container' >
			<table class='table-striped'>
				<thead>
					<th>Category</th>
					<th>Column A</th>
					<th>Column B</th>
					<th>Column C</th>
					<th>Column D</th>
					<th>Column Total</th>
				</thead>
				<tr ng-repeat="category in person.rows track by $index">
					<td><input class = 'form-control' type = 'number' class='' name='category' ng-model='category.number+1' disabled></td>
					<td>
						<select class='form-control' name='column-a-1' id='column-a-1' ng-change='addCategory(category.number)' ng-model='category.cols[0]'>
							<option value = 1>1</option>
							<option value = 2>2</option>
							<option value = 3>3</option>
						</select>
					</td>
					<td>
						<select class='form-control' name='column-b-1' id='column-b-1' ng-change='addCategory(category.number)' ng-model='category.cols[1]'>
							<option value = 1>1</option>
							<option value = 2>2</option>
							<option value = 3>3</option>
						</select>
					</td>
					<td>
						<select class='form-control' name='column-c-1' id='column-c-1' ng-change='addCategory(category.number)' ng-model='category.cols[2]'>
							<option value = 1>1</option>
							<option value = 2>2</option>
							<option value = 3>3</option>
						</select>
					</td>
					<td>
						<select class='form-control' name='column-d-1' id='column-d-1' ng-change='addCategory(category.number)' ng-model='category.cols[3]'>
							<option value = 1>1</option>
							<option value = 2>2</option>
							<option value = 3>3</option>
						</select>
					</td>
					<td>
						<input type='number' name='total-1' class='form-control' id='total-1' ng-model='category.total' disabled>
					</td></tr>

			</table>

		</div>
		<a href='#' ng-click='getData()'>asfjkaslkfas</a>;
		<button ng-click="getData()">Click me</button>
	</div>
		<script>
			'use strict';
			var getDataModule = angular.module('getData',[]);

			getDataModule.controller('gettingDataController', function($scope, $http){
				$scope.people = {};
				$scope.person = {};
				
				
				$scope.getData = function(){
					console.log('check');
					$http.get('/getpeople').success(function(data){
						$scope.people = data;
						console.log($scope.people)
					}).error(function(data, status, headers, config){
						console.log('something bad happened');
					});	
				}
				$scope.setPerson = function(id){
					$scope.person = $scope.people[id];
					console.log(id);


					for (var rowNumber = 0; rowNumber<10;rowNumber++)
					{
						$scope.person.rows[rowNumber].total = 
							parseInt($scope.person.rows[rowNumber].cols[0]) +
							parseInt($scope.person.rows[rowNumber].cols[1]) +
							parseInt($scope.person.rows[rowNumber].cols[2]) +
							parseInt($scope.person.rows[rowNumber].cols[3]);
					}
					
				}

				$scope.addCategory = function(rowNumber){
					$scope.person.rows[rowNumber].total = 
						parseInt($scope.person.rows[rowNumber].cols[0]) +
						parseInt($scope.person.rows[rowNumber].cols[1]) +
						parseInt($scope.person.rows[rowNumber].cols[2]) +
						parseInt($scope.person.rows[rowNumber].cols[3]);
				}

			});

		</script>
	</body>
</html>